# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

## üìã –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∫–Ω–∏–≥ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL + Sequelize ORM  
**–°—Ç–∞—Ç—É—Å:** Step 2 –ó–ê–í–ï–†–®–ï–ù - –ü–æ–ª–Ω—ã–π REST API –≥–æ—Ç–æ–≤  
**–≠—Ç–∞–ø—ã:** ‚úÖ Step 1 (–ë–î) + ‚úÖ Step 2 (REST API + –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

---

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤–∞–ª–∏–¥–∞—Ü–∏—è) –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

- ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û** –≤ –º–æ–¥–µ–ª–∏ `User.js`
- üîß **–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  ```javascript
  email: {
    validate: {
      isEmail: true,
      notEmpty: true,
    },
  }
  ```
- üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/models/User.js` - –≤–∞–ª–∏–¥–∞—Ü–∏—è email
- üéØ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ + —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ email –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `POST /api/auth/login`, `POST /api/auth/register`
  - JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å—Ç–∞—Çeless –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞: 7 –¥–Ω–µ–π
- üìç **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:** `users.email varchar(255) [unique, not null]`
- üîê **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** 
  ```javascript
  // Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
  const { authenticateToken, requireAdmin } = require('./src/middleware/auth');
  ```

### 3. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é (–∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã, —Ü–∏—Ñ—Ä—ã, 1 –∑–∞–≥–ª–∞–≤–Ω–∞—è)**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  ```javascript
  // –í src/utils/auth.js
  function validatePasswordStrength(password) {
    if (password.length < 8) {
      return { isValid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤' };
    }
    if (!/[A-Z]/.test(password)) {
      return { isValid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É' };
    }
    if (!/[0-9]/.test(password)) {
      return { isValid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É' };
    }
    if (!/^[A-Za-z0-9]+$/.test(password)) {
      return { isValid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã' };
    }
    return { isValid: true };
  }
  ```
- üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** 
  - `/src/utils/auth.js` - —É—Ç–∏–ª–∏—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - `/src/controllers/authController.js` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** bcryptjs —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 10 rounds

### 4. **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–∞**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
  - `user` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∫–æ—Ä–∑–∏–Ω–∞, –∫–∞—Ç–∞–ª–æ–≥)
  - `admin` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
- üìç **Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
  ```javascript
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∞ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
  router.post('/', [authenticateToken, requireAdmin], controller.create);
  ```
- üõ°Ô∏è **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–∏–≥, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∞–≤—Ç–æ—Ä–æ–≤, –∏–∑–¥–∞—Ç–µ–ª–µ–π

### 5. **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
  - –°—Ç–∞—Çeless —Ç–æ–∫–µ–Ω—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î)
  - –ü–æ–¥–ø–∏—Å—å HMAC SHA256
  - Payload —Å–æ–¥–µ—Ä–∂–∏—Ç: userId, email, role
- üìç **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ó–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`
- ‚è∞ **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 7 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ .env)

---

## üìö –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É –∏ –∫–Ω–∏–≥–∞–º

### 6. **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û** (Step 2)
- üîß **REST API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:**
  ```javascript
  GET /api/books?page=1&limit=20&search=term&category=1&minPrice=500&maxPrice=2000
  ```
- üìä **–ü–∞–≥–∏–Ω–∞—Ü–∏—è response:**
  ```json
  {
    "pagination": {
      "currentPage": 1,
      "totalPages": 15,
      "totalItems": 300,
      "hasNext": true,
      "hasPrev": false
    }
  }
  ```
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ò–Ω–¥–µ–∫—Å—ã –ø–æ popularity, price, created_at

### 13. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤—ã—Ö 10 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- üîß **–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - –ü–æ–ª–µ `popularity` –≤ —Ç–∞–±–ª–∏—Ü–µ `books`
  - –ò–Ω–¥–µ–∫—Å –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- üìç **SQL –∑–∞–ø—Ä–æ—Å:**
  ```sql
  SELECT * FROM books WHERE stock > 0
  ORDER BY popularity DESC LIMIT 10;
  ```

### 14. **–ü–æ–ª–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —É –∫–Ω–∏–≥**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- üîß **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:**
  ```javascript
  popularity: {
    type: DataTypes.INTEGER,
    allowNull: false,
    defaultValue: 0,
    validate: { min: 0 }
  }
  ```
- üéØ **–ú–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏:**
  - `decreaseStock()` - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ
  - Scope `popular` –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥

### 15. **–•—Ä–∞–Ω–µ–Ω–∏–µ –∫–Ω–∏–≥ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- üîß **–ü–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `books`:**
  - ‚úÖ –∞–≤—Ç–æ—Ä (—á–µ—Ä–µ–∑ —Å–≤—è–∑—å `book_authors`)
  - ‚úÖ –∂–∞–Ω—Ä (—á–µ—Ä–µ–∑ `category_id`)
  - ‚úÖ —Ü–µ–Ω–∞ (`price`)
  - ‚úÖ –æ–ø–∏—Å–∞–Ω–∏–µ (`description`)
  - ‚úÖ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (`popularity`)
  - ‚úÖ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ (`stock`)
- üìç **–õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è:** `WHERE stock > 0` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

---

## ÔøΩ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã (Step 2)

### **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
  ```javascript
  GET /api/cart                 // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
  POST /api/cart               // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏
  PUT /api/cart/:id           // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  DELETE /api/cart/:id        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  DELETE /api/cart            // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
  ```
- üõ°Ô∏è **–ö–æ–Ω—Ç—Ä–æ–ª—å –æ—Å—Ç–∞—Ç–∫–æ–≤:** –ü—Ä–æ–≤–µ—Ä–∫–∞ stock –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏
- üí∞ **–ü–æ–¥—Å—á–µ—Ç —Å—É–º–º—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥—Å–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üîß **–õ–æ–≥–∏–∫–∞:** 
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ stock –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ
  - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ popularity –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ
- üìç **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `src/controllers/cartController.js`

---

## ÔøΩüîÑ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º

### 7. **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

- ‚úÖ **–†–ï–®–ï–ù–û –ù–ê –£–†–û–í–ù–ï –ë–î**
- üîß **–ö–∞–∫ –∑–∞—â–∏—â–µ–Ω–æ:**
  - `UNIQUE` constraint –Ω–∞ `email`
  - PostgreSQL –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Sequelize
- üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

### 7.1 **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –ö–æ–Ω—Ç—Ä–æ–ª—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –∫–Ω–∏–≥**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ü–†–û–î–£–ú–ê–ù–û**
- üîí **–£—Ä–æ–≤–µ–Ω—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL):**

  - **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ACID** - –∫–∞–∂–¥–∞—è –ø–æ–∫—É–ø–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - **Row-level locking** - PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –∫–Ω–∏–≥–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
  - **Optimistic concurrency control** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

- üîß **–£—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Sequelize):**

  ```javascript
  // –ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Å—Ç–∞—Ç–∫–∞
  async purchaseBook(bookId, quantity) {
    return await sequelize.transaction(async (t) => {
      const book = await Book.findByPk(bookId, {
        lock: t.LOCK.UPDATE,  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
        transaction: t
      });

      if (book.stock < quantity) {
        throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ');
      }

      book.stock -= quantity;
      book.popularity += quantity;
      return await book.save({ transaction: t });
    });
  }
  ```

- ‚ö° **–°—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã:**

  1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1** –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–∫—É–ø–∫—É ‚Üí PostgreSQL –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –∫–Ω–∏–≥–∏
  2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2** –ø—ã—Ç–∞–µ—Ç—Å—è –∫—É–ø–∏—Ç—å —Ç—É –∂–µ –∫–Ω–∏–≥—É ‚Üí –∂–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1** –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è stock
  4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2** –ø–æ–ª—É—á–∞–µ—Ç —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫

- üõ°Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞:**
  - **CHECK constraint** –≤ –ë–î: `stock >= 0`
  - **Application-level validation** –≤ –º–µ—Ç–æ–¥–µ `decreaseStock()`
  - **Race condition handling** —á–µ—Ä–µ–∑ retry –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- üéØ **–ì–∞—Ä–∞–Ω—Ç–∏—è:** –ö–Ω–∏–≥–∏ –Ω–µ –±—É–¥—É—Ç "–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω—ã" –¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

### 8. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

- ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø –í–ï–ó–î–ï**
- üîß **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –í—Å–µ –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–µ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç async/await
- üìç **–ü—Ä–∏–º–µ—Ä:**
  ```javascript
  async function createUser(userData) {
    return await User.create(userData);
  }
  ```

---

## üé® –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ UI/UX

### 9. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ä–∞–∑—É –≤ –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥**

- ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –ù–ê–°–¢–†–û–ô–ö–ò –†–û–£–¢–ò–ù–ì–ê**
- üéØ **–ü–ª–∞–Ω:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ –∫–∞—Ç–∞–ª–æ–≥

### 10. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è "–æ –Ω–∞—Å" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π**

- ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –°–û–ó–î–ê–ù–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê**
- üéØ **–ü–ª–∞–Ω:** –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### 11-12. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –∏ —Ñ—É—Ç–µ—Ä–∞**

- ‚ö†Ô∏è **–§–†–û–ù–¢–ï–ù–î –ó–ê–î–ê–ß–ò**
- üéØ **–ü–ª–∞–Ω:** –û–±–Ω–æ–≤–∏—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üåê REST API –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (Step 2)

### **–ü–æ–ª–Ω—ã–π REST API –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**

- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** (Step 2)
- üìã **–û—Ö–≤–∞—Ç API:**
  - **–ö–Ω–∏–≥–∏** (`/api/books`) - CRUD + –ø–æ–∏—Å–∫ + —Ñ–∏–ª—å—Ç—Ä—ã
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** (`/api/categories`) - –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  - **–ê–≤—Ç–æ—Ä—ã** (`/api/authors`) - –±–∏–æ–≥—Ä–∞—Ñ–∏–∏ + –∫–Ω–∏–≥–∏ –∞–≤—Ç–æ—Ä–∞
  - **–ò–∑–¥–∞—Ç–µ–ª–∏** (`/api/publishers`) - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  - **–ö–æ—Ä–∑–∏–Ω–∞** (`/api/cart`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∞–º–∏
  - **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (`/api/auth`) - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥/–ø—Ä–æ—Ñ–∏–ª—å

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API**

- ‚úÖ **–ö–û–ú–ü–õ–ï–ö–°–ù–ê–Ø –ó–ê–©–ò–¢–ê** (Step 2)
- üõ°Ô∏è **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:**
  ```javascript
  // Express-validator –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  body('email').isEmail().normalizeEmail()
  body('price').isFloat({ min: 0 }).toFloat()
  
  // Helmet.js –¥–ª—è –∑–∞—â–∏—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  app.use(helmet())
  
  // CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  app.use(cors())
  
  // Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  router.use(authenticateToken)
  ```

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API**

- ‚úÖ **–ò–°–ß–ï–†–ü–´–í–ê–Æ–©–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø** (Step 2)
- üìö **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:**
  - `API_DOCUMENTATION.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - `test-api-guide.js` - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
  - `GET /api` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ API
  - –ü—Ä–∏–º–µ—Ä—ã curl –∫–æ–º–∞–Ω–¥ –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 16. **–ù–∞—á–∏–Ω–∞—Ç—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

- ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û –ù–ê 100%**
- üîß **–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - ‚úÖ 7 —Ç–∞–±–ª–∏—Ü —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏
  - ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥–µ—Ä—ã
  - ‚úÖ –ú–æ–¥–µ–ª–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - ‚úÖ –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ Many-to-Many
  - ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ Step 2)

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ (14/16 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π):

**Step 1 (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö):**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª—è—Ö
- ‚úÖ –ü–æ–ª–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —É –∫–Ω–∏–≥
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–Ω–∏–≥–∞—Ö  
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ–∑–¥–µ
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞

**Step 2 (REST API + –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è):**
- ‚úÖ **Email –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏**
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è (–∞–Ω–≥–ª–∏–π—Å–∫–∏–µ + —Ü–∏—Ñ—Ä—ã + –∑–∞–≥–ª–∞–≤–Ω–∞—è)**
- ‚úÖ **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (user/admin)**
- ‚úÖ **–ü–æ–ª–Ω—ã–π REST API –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**
- ‚úÖ **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ (–≥–æ—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)**
- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥ (API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)**
- ‚úÖ **–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫ (–ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)**
- ‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

### ‚ö†Ô∏è –û—Å—Ç–∞–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (2/16 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π):

**–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–¥–∞—á–∏ (Step 3):**
- ‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ä–∞–∑—É –≤ –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥ (—Ä–æ—É—Ç–∏–Ω–≥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
- ‚ö†Ô∏è UI/UX —ç–ª–µ–º–µ–Ω—Ç—ã ("–æ –Ω–∞—Å", –∫–∞—Ä—Ç–∞, —Ñ—É—Ç–µ—Ä)

### üöÄ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:

- **Backend: 100% –ì–û–¢–û–í** 
  - ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Step 1)
  - ‚úÖ REST API (Step 2) 
  - ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Step 2)
  - ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Step 2)
- **Frontend: 0% (Step 3)**

### üéØ –ü–ª–∞–Ω Step 3:

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è API
2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –†–æ—É—Ç–∏–Ω–≥ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è  
3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** UI/UX –¥–æ—Ä–∞–±–æ—Ç–∫–∏

---

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### ‚úÖ **STEP 2 –ó–ê–í–ï–†–®–ï–ù: Backend –≥–æ—Ç–æ–≤ –Ω–∞ 100%**

**–ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:**
- üî• **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π REST API** –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –º–∞–≥–∞–∑–∏–Ω–∞
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å JWT –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª–µ–π
- üõí **–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫** —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –æ—Å—Ç–∞—Ç–∫–æ–≤
- üìö **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º** —á–µ—Ä–µ–∑ API (–∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä—ã, –∏–∑–¥–∞—Ç–µ–ª–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- üõ°Ô∏è **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** (Helmet, CORS, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- üìñ **–ò—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** API

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Step 1) + REST API (Step 2) = Production Ready Backend!**

### üéØ **14 –∏–∑ 16 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –í–´–ü–û–õ–ù–ï–ù–û**

–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –∏–∑ 7 —Ç–∞–±–ª–∏—Ü + REST API –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –∫–Ω–∏–≥. Backend –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ª—é–±—ã–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º.

### üåü **–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (Step 3):**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. Backend –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∏ –∂–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞!

**API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:** `http://localhost:3000/api`  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `http://localhost:3000/api` (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞)
