# üèóÔ∏è –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –û–±–∑–æ—Ä

–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –º—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é Sequelize CLI –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö Sequelize –º–æ–¥–µ–ª–µ–π.

## üõ†Ô∏è –ü–æ—à–∞–≥–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üìã **–®–∞–≥ 3.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
# Windows: –î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á ‚Üí –°–ª—É–∂–±—ã ‚Üí postgresql-x64-xx (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞)

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
psql -U postgres -h localhost
\l    # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
\q    # –í—ã–π—Ç–∏ –∏–∑ psql

# 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
psql -U postgres -c "SELECT version();"
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- –ü—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ —Å–ª—É–∂–±–∞ PostgreSQL –∑–∞–ø—É—â–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- `psql -U postgres` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –ø–æ–¥ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- `\l` - SQL –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ
- `SELECT version()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Å–∏—é PostgreSQL –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### üìã **–®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Sequelize**

```bash
# 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd lab_2_sequelize

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
cat config/config.json    # Linux/Mac
type config\config.json   # Windows

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ config.json)
npx sequelize-cli db:create

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –±–∞–∑–∞ —Å–æ–∑–¥–∞–Ω–∞
psql -U postgres -c "\l" | findstr bookstore    # Windows
psql -U postgres -c "\l" | grep bookstore       # Linux/Mac
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `npx sequelize-cli db:create` - —á–∏—Ç–∞–µ—Ç config.json –∏ —Å–æ–∑–¥–∞–µ—Ç –ë–î —Å –∏–º–µ–Ω–µ–º –∏–∑ –ø–æ–ª—è "database"
- –°–æ–∑–¥–∞–µ—Ç—Å—è –ë–î "bookstore_dev" (–¥–ª—è development –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- –ö–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ï—Å–ª–∏ –ë–î —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

### üìã **–®–∞–≥ 3.3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)**

```bash
# 1. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
npx sequelize-cli migration:status

# 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö pending –º–∏–≥—Ä–∞—Ü–∏–π
npx sequelize-cli db:migrate

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
psql -U postgres -d bookstore_dev -c "\dt"    # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
psql -U postgres -d bookstore_dev -c "\d users"    # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã users
psql -U postgres -d bookstore_dev -c "\d books"    # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã books
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `migration:status` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π (pending/completed)
- `db:migrate` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
- –°–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã: `users`, `books`, `SequelizeMeta` (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π)
- `\dt` - PostgreSQL –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- `\d table_name` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã

### üìã **–®–∞–≥ 3.4: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (seeders)**

```bash
# 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∏–¥–µ—Ä–æ–≤
ls seeders/    # Linux/Mac
dir seeders\   # Windows

# 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∏–¥–µ—Ä–æ–≤
npx sequelize-cli db:seed:all

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -d bookstore_dev -c "SELECT COUNT(*) FROM books;"
psql -U postgres -d bookstore_dev -c "SELECT title, author, price, stock FROM books;"

# 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∏–¥–µ—Ä–∞
npx sequelize-cli db:seed --seed 20251013144632-demo-books.js
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `db:seed:all` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∏–¥–µ—Ä–æ–≤ –≤ –ø–∞–ø–∫–µ seeders/
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–∏–≥–∏ –≤ —Ç–∞–±–ª–∏—Ü—É books
- `SELECT COUNT(*)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- `--seed filename` - –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–∏–¥–µ—Ä

### üìã **–®–∞–≥ 3.5: –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π Sequelize**

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã)
touch models/User.js    # Linux/Mac
echo. > models\User.js  # Windows

touch models/Book.js    # Linux/Mac
echo. > models\Book.js  # Windows

# 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–µ–π
touch test-models.js    # Linux/Mac
echo. > test-models.js  # Windows

# 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –º–æ–¥–µ–ª–µ–π
npm install bcrypt joi    # –î–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

# 4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –º–æ–¥–µ–ª–µ–π
node test-models.js
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `touch/echo` - —Å–æ–∑–¥–∞—é—Ç –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π
- `bcrypt` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- `joi` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `node test-models.js` - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

### üìã **–®–∞–≥ 3.6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ë–î**

```bash
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -d bookstore_dev

# –í psql –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
\dt                          # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
SELECT * FROM "SequelizeMeta";   # –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
SELECT COUNT(*) FROM books;     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥
SELECT COUNT(*) FROM users;     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
\di                          # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

# 3. –ü—Ä–æ—Å–º–æ—Ç—Ä JSONB –¥–∞–Ω–Ω—ã—Ö
SELECT title, metadata FROM books WHERE metadata IS NOT NULL;

# 4. –í—ã—Ö–æ–¥ –∏–∑ psql
\q
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- `SequelizeMeta` - —Å–ª—É–∂–µ–±–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Sequelize –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- `\di` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSONB –ø–æ–ª–µ–π –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

### üìã **–®–∞–≥ 3.7: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –ë–î**

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump -U postgres -h localhost -d bookstore_dev > bookstore_backup.sql

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)
pg_dump -U postgres -h localhost -d bookstore_dev --schema-only > bookstore_schema.sql

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö
pg_dump -U postgres -h localhost -d bookstore_dev --data-only > bookstore_data.sql
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `pg_dump` - —É—Ç–∏–ª–∏—Ç–∞ PostgreSQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- `> file.sql` - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª
- `--schema-only` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü, –∏–Ω–¥–µ–∫—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- `--data-only` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### üìã **–®–∞–≥ 3.8: –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)**

```bash
# 1. –û—Ç–∫–∞—Ç –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π (–û–°–¢–û–†–û–ñ–ù–û - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã!)
npx sequelize-cli db:migrate:undo:all

# 2. –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
npx sequelize-cli db:migrate:undo

# 3. –û—Ç–∫–∞—Ç —Å–∏–¥–µ—Ä–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
npx sequelize-cli db:seed:undo:all

# 4. –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –ë–î
npx sequelize-cli db:drop        # –£–¥–∞–ª–µ–Ω–∏–µ –ë–î
npx sequelize-cli db:create      # –°–æ–∑–¥–∞–Ω–∏–µ –ë–î
npx sequelize-cli db:migrate     # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npx sequelize-cli db:seed:all    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
```

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:**

- `db:migrate:undo` - –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- `db:seed:undo` - —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–∏–¥–µ—Ä–∞–º–∏
- `db:drop` - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å drop‚Üícreate‚Üímigrate‚Üíseed –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –ë–î

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

```bash
npx sequelize-cli db:create
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Database bookstore_dev created.
```

### ‚úÖ 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)

```bash
npx sequelize-cli db:migrate
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
== 20251013143521-create-users: migrated (0.087s)
== 20251013144458-create-books: migrated (0.071s)
```

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

- üìã **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–∫–∞–∑–æ–≤ –≤ JSONB
- üìö **books** - –∫–Ω–∏–≥–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –≤ JSONB

### ‚úÖ 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
npx sequelize-cli db:seed:all
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
== 20251013144632-demo-books: migrated (0.022s)
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ 6 –∫–Ω–∏–≥ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:**

- –†–∞–∑–Ω–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (45-150 –ø–æ–∫—É–ø–æ–∫)
- –†–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ (0-25 —à—Ç—É–∫)
- –†–∞–∑–Ω—ã–µ —Ü–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (550‚ÇΩ-1750‚ÇΩ)

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`

| –ü–æ–ª–µ               | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ                      |
| ------------------ | ------------ | ----------------------------- |
| **id**             | SERIAL       | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID              |
| **email**          | VARCHAR(255) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email –¥–ª—è –≤—Ö–æ–¥–∞    |
| **password_hash**  | VARCHAR(255) | –•–µ—à –ø–∞—Ä–æ–ª—è (bcrypt)           |
| **first_name**     | VARCHAR(100) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è              |
| **last_name**      | VARCHAR(100) | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| **orders_history** | **JSONB**    | üî• **–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –≤ JSON** |
| **created_at**     | TIMESTAMP    | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                 |
| **updated_at**     | TIMESTAMP    | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è               |

### –¢–∞–±–ª–∏—Ü–∞ `books`

| –ü–æ–ª–µ                  | –¢–∏–ø           | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| --------------------- | ------------- | ------------------------------ |
| **id**                | SERIAL        | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID               |
| **title**             | VARCHAR(255)  | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏                 |
| **author**            | VARCHAR(255)  | –ê–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏                    |
| **genre**             | VARCHAR(100)  | –ñ–∞–Ω—Ä –∫–Ω–∏–≥–∏                     |
| **price**             | DECIMAL(10,2) | –¶–µ–Ω–∞ –∫–Ω–∏–≥–∏                     |
| **description**       | TEXT          | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ                |
| **short_description** | TEXT          | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ               |
| **image**             | VARCHAR(255)  | –ò–º—è —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è          |
| **popularity**        | INTEGER       | üî• **–°—á–µ—Ç—á–∏–∫ –ø–æ–∫—É–ø–æ–∫**         |
| **stock**             | INTEGER       | üî• **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ**    |
| **metadata**          | **JSONB**     | üî• **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ** |
| **created_at**        | TIMESTAMP     | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                  |
| **updated_at**        | TIMESTAMP     | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è                |

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ Sequelize –º–æ–¥–µ–ª–∏

### üìÑ `models/User.js` - –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### üîë **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- ‚úÖ **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** (bcrypt, 12 —Ä–∞—É–Ω–¥–æ–≤)
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è email** (—Ñ–æ—Ä–º–∞—Ç –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
- ‚úÖ **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è** (8+ —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ/—Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã)
- ‚úÖ **JSONB –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤** (UUID, –∫–Ω–∏–≥–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, –¥–∞—Ç–∞)
- ‚úÖ **–ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (createUser, authenticate, findByEmail)

#### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
const user = await User.createUser({
  email: "test@example.com",
  password: "SecurePass123",
  first_name: "–ò–≤–∞–Ω",
  last_name: "–ü–µ—Ç—Ä–æ–≤",
});

// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
const authUser = await User.authenticate("test@example.com", "SecurePass123");

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
await user.addOrder({
  book_id: 1,
  title: "–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü",
  quantity: 2,
  price: 450.0,
  total: 900.0,
});

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫
console.log(user.getOrdersCount()); // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
console.log(user.getTotalSpent()); // –û–±—â–∞—è —Å—É–º–º–∞
```

### üìö `models/Book.js` - –ú–æ–¥–µ–ª—å –∫–Ω–∏–≥–∏

#### üîë **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è, —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ)
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏** (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–µ)
- ‚úÖ **JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, ISBN, –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ)
- ‚úÖ **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** (–ø–æ —Ç–µ–∫—Å—Ç—É, –∂–∞–Ω—Ä—É, —Ü–µ–Ω–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
- ‚úÖ **Race condition –∑–∞—â–∏—Ç–∞** (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ FOR UPDATE –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö)

#### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```javascript
// –ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –≤ –Ω–∞–ª–∏—á–∏–∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
const books = await Book.findAvailable({
  limit: 10,
  genre: "–¥–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞",
  priceMin: 300,
  priceMax: 1000,
});

// –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
const results = await Book.search("–ø—Ä–∏–Ω—Ü");

// –ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç race conditions)
const transaction = await sequelize.transaction();
const book = await Book.purchaseBooks(bookId, quantity, transaction);
await transaction.commit();

// –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏
const popular = await Book.findPopular(10);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–∞
const stats = await Book.getStats();
// { total: 6, available: 5, outOfStock: 1, percentage: 83 }
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### üöÄ **–°–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç-—Ñ–∞–π–ª:** `test-models.js`

**–¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

1. ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL**
2. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª—è
3. ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å)
4. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ –Ω–∞–ª–∏—á–∏—é –Ω–∞ —Å–∫–ª–∞–¥–µ
6. ‚úÖ **–ü–æ–∏—Å–∫** –ø–æ —Ç–µ–∫—Å—Ç—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏/–∞–≤—Ç–æ—Ä–µ
7. ‚úÖ **–ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π)
8. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
9. ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–Ω–∏–≥** (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –≤ –Ω–∞–ª–∏—á–∏–∏, –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å)
10. ‚úÖ **–¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö** –∫–Ω–∏–≥

### üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```bash
node test-models.js

üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π Sequelize...

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å–ø–µ—à–Ω–æ!
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: { id: 3, email: 'test@example.com', name: '–ò–≤–∞–Ω –¢–µ—Å—Ç–æ–≤' }
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: –î–∞
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è: –†–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ù–∞–π–¥–µ–Ω–æ 3 –∫–Ω–∏–≥ –≤ –ë–î
‚úÖ –ù–∞–π–¥–µ–Ω–æ 5 –∫–Ω–∏–≥ –≤ –Ω–∞–ª–∏—á–∏–∏ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏)
‚úÖ –ü–æ–∏—Å–∫ –ø–æ "–ø—Ä–∏–Ω—Ü": –Ω–∞–π–¥–µ–Ω–æ 1 –∫–Ω–∏–≥
‚úÖ –ü–æ–∫—É–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–∫–ª–∞–¥ —É–º–µ–Ω—å—à–µ–Ω —Å 8 –¥–æ 7
‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ —Å 120 –¥–æ 121
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 6 –∫–Ω–∏–≥ –≤—Å–µ–≥–æ, 5 –≤ –Ω–∞–ª–∏—á–∏–∏ (83% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
‚úÖ –¢–æ–ø-3 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥ –ø–æ–ª—É—á–µ–Ω—ã

üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
```

## üîç –î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ

### üìö **–ö–Ω–∏–≥–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ:**

| –ù–∞–∑–≤–∞–Ω–∏–µ             | –ê–≤—Ç–æ—Ä                   | –¶–µ–Ω–∞  | –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å | –°–∫–ª–∞–¥    |
| -------------------- | ----------------------- | ----- | ------------ | -------- |
| **–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü**  | –ê–Ω—Ç—É–∞–Ω –¥–µ –°–µ–Ω—Ç-–≠–∫–∑—é–ø–µ—Ä–∏ | 450‚ÇΩ  | üî• **150**   | 25       |
| **–ì—Ä–æ–∑–∞**            | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –û—Å—Ç—Ä–æ–≤—Å–∫–∏–π    | 550‚ÇΩ  | üî• **121**   | 7        |
| **–ß–µ–ª–æ–≤–µ–∫-–∞–º—Ñ–∏–±–∏—è**  | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë–µ–ª—è–µ–≤        | 1750‚ÇΩ | 95           | 20       |
| **–£–Ω–µ—Å—ë–Ω–Ω—ã–µ –≤–µ—Ç—Ä–æ–º** | –ú–∞—Ä–≥–∞—Ä–µ—Ç –ú–∏—Ç—á–µ–ª–ª        | 900‚ÇΩ  | 86           | 14       |
| **–ú–æ—Ä–µ –∏ –∑–≤–µ–∑–¥—ã**    | –ê–ª–µ–∫—Å–µ–π –ë–∏—Ä—é–ª–∏–Ω         | 1670‚ÇΩ | 45           | 12       |
| **–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏**   | –§—Ä—ç–Ω—Å–∏—Å –§–∏—Ü–¥–∂–µ—Ä–∞–ª—å–¥     | 1200‚ÇΩ | 78           | ‚ùå **0** |

### üéØ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:**

- ‚úÖ –†–∞–∑–Ω—ã–µ **—Ü–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** (low: <500‚ÇΩ, medium: 500-1000‚ÇΩ, high: >1000‚ÇΩ)
- ‚úÖ –†–∞–∑–Ω–∞—è **–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- ‚úÖ **–ù—É–ª–µ–≤–æ–π —Å–∫–ª–∞–¥** —É –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (`romance`, `foreign`, `price-low`)

## üîß –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üìà **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**

**–î–ª—è —Ç–∞–±–ª–∏—Ü—ã users:**

- `users_email_unique_idx` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ email
- `users_created_at_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ

**–î–ª—è —Ç–∞–±–ª–∏—Ü—ã books:**

- `books_popularity_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
- `books_stock_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –Ω–∞–ª–∏—á–∏—é
- `books_genre_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∂–∞–Ω—Ä—É
- `books_author_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∞–≤—Ç–æ—Ä—É
- `books_price_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω–µ
- `books_metadata_gin_idx` - **GIN –∏–Ω–¥–µ–∫—Å** –¥–ª—è JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### üîí **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞:**

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - bcrypt —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - Joi —Å—Ö–µ–º—ã –≤ –º–æ–¥–µ–ª—è—Ö
3. **SQL –∏–Ω—ä–µ–∫—Ü–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Sequelize ORM
4. **Race conditions** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `FOR UPDATE` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
5. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ë–î** - constraints –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL

### ‚ö° **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```javascript
// –ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏ - –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
const transaction = await sequelize.transaction();
try {
  const book = await Book.purchaseBooks(bookId, quantity, transaction);
  await transaction.commit();
} catch (error) {
  await transaction.rollback();
  throw error;
}
```

## üìä SQL –∑–∞–ø—Ä–æ—Å—ã (–ø—Ä–∏–º–µ—Ä—ã)

### üîç **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ –≤ –Ω–∞–ª–∏—á–∏–∏:**

```sql
SELECT * FROM books
WHERE stock > 0
ORDER BY popularity DESC, created_at DESC
LIMIT 10;
```

### üîç **–ü–æ–∏—Å–∫ –ø–æ JSONB –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**

```sql
SELECT * FROM books
WHERE metadata @> '{"categories": ["romance"]}'
AND stock > 0;
```

### üîç **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```sql
SELECT
  email,
  jsonb_array_length(orders_history) as orders_count,
  (
    SELECT SUM((order_item->>'total')::numeric)
    FROM jsonb_array_elements(orders_history) as order_item
  ) as total_spent
FROM users
WHERE id = 1;
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞**
2. ‚úÖ **–ú–æ–¥–µ–ª–∏ Sequelize —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
3. ‚è≥ **–°–æ–∑–¥–∞–Ω–∏–µ Express —Å–µ—Ä–≤–µ—Ä–∞ –∏ API —Ä–æ—É—Ç–æ–≤**
4. ‚è≥ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT –∏ middleware**
5. ‚è≥ **API –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–æ–º**
6. ‚è≥ **API –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –∏ –∫–æ—Ä–∑–∏–Ω—ã**

## üí° –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

- ‚úÖ **2 —Ç–∞–±–ª–∏—Ü—ã –≤–º–µ—Å—Ç–æ 3** - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- ‚úÖ **JSONB –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏** - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —É—á—Ç–µ–Ω—ã

### ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤—Å–µ—Ö —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - JSONB –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ –®–∞–≥—É 4: –°–æ–∑–¥–∞–Ω–∏–µ Express API —Å–µ—Ä–≤–µ—Ä–∞** ‚û°Ô∏è
