# üèóÔ∏è models/index.js - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä

–§–∞–π–ª `models/index.js` —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Sequelize ORM –≤ –ø—Ä–æ–µ–∫—Ç–µ. –û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL**
2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π User –∏ Book**
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏**
4. **–≠–∫—Å–ø–æ—Ä—Ç –æ–±—ä–µ–∫—Ç–∞ `db` —Å –º–æ–¥–µ–ª—è–º–∏ –∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏**
5. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ Sequelize –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º**

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞

### 1. –ò–º–ø–æ—Ä—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```javascript
"use strict";

const fs = require("fs"); // –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
const path = require("path"); // –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏ —Ñ–∞–π–ª–æ–≤
const Sequelize = require("sequelize"); // ORM Sequelize
const process = require("process"); // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤:**

- `fs` - –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏, —É –Ω–∞—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `path` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏ –∫ —Ñ–∞–π–ª–∞–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `Sequelize` - –æ—Å–Ω–æ–≤–Ω–∞—è ORM –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- `process` - –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è (NODE_ENV)

### 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```javascript
const basename = path.basename(__filename); // "index.js"
const env = process.env.NODE_ENV || "development";
const config = require(__dirname + "/../config/config.json")[env];
const db = {};
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

- `basename` - –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ ("index.js")
- `env` - —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (development/test/production)
- `config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ä–µ–¥—ã
- `db` - –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –∏ —É—Ç–∏–ª–∏—Ç

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequelize

```javascript
let sequelize;
if (config.use_env_variable) {
  // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (production)
  sequelize = new Sequelize(process.env[config.use_env_variable], config);
} else {
  // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ config.json (development/test)
  sequelize = new Sequelize(
    config.database, // bookstore_dev
    config.username, // bookstore_user
    config.password, // secure_password
    config // { host, port, dialect, logging, etc. }
  );
}
```

**–î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**

#### Development/Test —Ä–µ–∂–∏–º:

```json
{
  "username": "bookstore_user",
  "password": "secure_password",
  "database": "bookstore_dev",
  "host": "127.0.0.1",
  "port": 5432,
  "dialect": "postgres"
}
```

#### Production —Ä–µ–∂–∏–º:

```json
{
  "use_env_variable": "DATABASE_URL"
}
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL` —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

```javascript
// –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
const User = require("./User")(sequelize);
const Book = require("./Book")(sequelize);

// –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–µ–ª–∏ –≤ –æ–±—ä–µ–∫—Ç db
db.User = User;
db.Book = Book;
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- –ú–æ–¥–µ–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é** (–Ω–µ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏)
- –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `sequelize` instance
- –ú–æ–¥–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç–µ `db` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π

```javascript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π
Object.keys(db).forEach((modelName) => {
  if (db[modelName].associate) {
    db[modelName].associate(db);
  }
});
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ `associate`
3. –í—ã–∑—ã–≤–∞–µ–º `associate(db)` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤—è–∑–µ–π

**–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:** User –∏ Book –∏–º–µ—é—Ç –ø—É—Å—Ç—ã–µ –º–µ—Ç–æ–¥—ã `associate`, —Ç–∞–∫ –∫–∞–∫ —Å–≤—è–∑–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ JSONB (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º 2 —Ç–∞–±–ª–∏—Ü—ã).

### 6. –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```javascript
// –î–æ–±–∞–≤–ª—è–µ–º sequelize –∏ Sequelize –≤ –æ–±—ä–µ–∫—Ç db –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
db.sequelize = sequelize; // –≠–∫–∑–µ–º–ø–ª—è—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
db.Sequelize = Sequelize; // –ö–ª–∞—Å—Å Sequelize

// –≠–∫—Å–ø–æ—Ä—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ Sequelize –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
db.Op = Sequelize.Op; // –û–ø–µ—Ä–∞—Ç–æ—Ä—ã (Op.gt, Op.like, etc.)

module.exports = db;
```

**–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç `db` —Å–æ–¥–µ—Ä–∂–∏—Ç:**

- `db.User` - –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `db.Book` - –º–æ–¥–µ–ª—å –∫–Ω–∏–≥
- `db.sequelize` - instance –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `db.Sequelize` - –∫–ª–∞—Å—Å Sequelize –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
- `db.Op` - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

## üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:

```javascript
const { User, Book, Op, sequelize } = require("../models");

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
const users = await User.findAll();
const books = await Book.findAll();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
const expensiveBooks = await Book.findAll({
  where: {
    price: { [Op.gt]: 1000 },
  },
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
const transaction = await sequelize.transaction();
```

### –í —Ä–æ—É—Ç–∞—Ö Express:

```javascript
const db = require("../models");

app.get("/api/books", async (req, res) => {
  try {
    const books = await db.Book.findAvailable({
      limit: 20,
      offset: 0,
    });
    res.json(books);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

### –í —Ç–µ—Å—Ç–∞—Ö:

```javascript
const { User, Book, sequelize } = require("../models");

beforeEach(async () => {
  await sequelize.sync({ force: true }); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
});

afterAll(async () => {
  await sequelize.close(); // –ó–∞–∫—Ä—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
});
```

## üìä –û–ø–µ—Ä–∞—Ç–æ—Ä—ã Sequelize (db.Op)

### –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:

```javascript
const { Op } = require("../models");

// –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
{ price: { [Op.gt]: 500 } }          // price > 500
{ price: { [Op.gte]: 500 } }         // price >= 500
{ price: { [Op.lt]: 1000 } }         // price < 1000
{ price: { [Op.lte]: 1000 } }        // price <= 1000
{ stock: { [Op.ne]: 0 } }            // stock != 0

// –î–∏–∞–ø–∞–∑–æ–Ω
{ price: { [Op.between]: [500, 1000] } }  // price BETWEEN 500 AND 1000
{ stock: { [Op.in]: [1, 2, 3] } }         // stock IN (1, 2, 3)

// –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
{ title: { [Op.like]: "%–ø—Ä–∏–Ω—Ü%" } }       // LIKE '%–ø—Ä–∏–Ω—Ü%'
{ title: { [Op.iLike]: "%–ø—Ä–∏–Ω—Ü%" } }      // ILIKE '%–ø—Ä–∏–Ω—Ü%' (–±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)

// –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
{
  [Op.and]: [
    { stock: { [Op.gt]: 0 } },
    { price: { [Op.lt]: 1000 } }
  ]
}

{
  [Op.or]: [
    { genre: "—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞" },
    { genre: "–¥–µ—Ç–µ–∫—Ç–∏–≤" }
  ]
}

// JSONB –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (–¥–ª—è metadata)
{ metadata: { [Op.contains]: { categories: ["romance"] } } }  // @>
```

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:

```javascript
// –í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
fs.readdirSync(__dirname)
  .filter((file) => {
    return (
      file.indexOf(".") !== 0 && file !== basename && file.slice(-3) === ".js"
    );
  })
  .forEach((file) => {
    const model = require(path.join(__dirname, file));
    db[model.name] = model;
  });
```

**–ù–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—á–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –¥–ª—è:**

- –õ—É—á—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- –ò–∑–±–µ–∂–∞–Ω–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```javascript
// .env —Ñ–∞–π–ª
DATABASE_URL=postgres://user:pass@localhost:5432/dbname
NODE_ENV=production

// –í index.js
require('dotenv').config();

const sequelize = new Sequelize(process.env.DATABASE_URL, {
  dialect: 'postgres',
  logging: process.env.NODE_ENV === 'development' ? console.log : false
});
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

```javascript
async function testConnection() {
  try {
    await sequelize.authenticate();
    console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å–ø–µ—à–Ω–æ!");

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π
    console.log("üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:", Object.keys(db));

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
    console.log("üîß –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã:", !!db.Op);
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:", error);
  }
}

testConnection();
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π:

```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
await sequelize.sync({ force: true }); // –£–¥–∞–ª—è–µ—Ç –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç
await sequelize.sync({ alter: true }); // –ò–∑–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
await sequelize.sync(); // –°–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–µ `sync()`!

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```javascript
const sequelize = new Sequelize(
  config.database,
  config.username,
  config.password,
  {
    ...config,
    logging: (sql, timing) => {
      if (process.env.NODE_ENV === "development") {
        console.log(`[${timing}ms] ${sql}`);
      }

      // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      if (timing > 1000) {
        console.warn(`üêå Slow query (${timing}ms):`, sql);
      }
    },
    benchmark: true, // –í–∫–ª—é—á–∞–µ—Ç timing
  }
);
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:

```javascript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
const sequelize = new Sequelize(
  config.database,
  config.username,
  config.password,
  {
    ...config,
    pool: {
      max: 10, // –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
      min: 2, // –ú–∏–Ω–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
      acquire: 30000, // –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (30 —Å–µ–∫)
      idle: 10000, // –¢–∞–π–º–∞—É—Ç –ø—Ä–æ—Å—Ç–æ—è (10 —Å–µ–∫)
    },
  }
);

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
setInterval(() => {
  const pool = sequelize.connectionManager.pool;
  console.log(
    `üèä‚Äç‚ôÇÔ∏è Pool: ${pool.size} used, ${pool.available} available, ${pool.pending} pending`
  );
}, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```javascript
// config/config.json (production)
{
  "production": {
    "use_env_variable": "DATABASE_URL",
    "dialect": "postgres",
    "dialectOptions": {
      "ssl": {
        "require": true,
        "rejectUnauthorized": false
      }
    },
    "logging": false
  }
}
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):

```bash
# .env —Ñ–∞–π–ª (–ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å –≤ git!)
NODE_ENV=production
DATABASE_URL=postgres://user:password@host:5432/database
DB_SSL=true
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```javascript
const sequelize = new Sequelize(
  config.database,
  config.username,
  config.password,
  {
    ...config,

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    pool: {
      max: 20, // –ë–æ–ª—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
      min: 5, // –í—Å–µ–≥–¥–∞ –¥–µ—Ä–∂–∏–º –º–∏–Ω–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
      acquire: 60000,
      idle: 10000,
    },

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∞–ª–µ–∫—Ç–∞ PostgreSQL
    dialectOptions: {
      statement_timeout: 30000, // –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
      query_timeout: 30000,
      application_name: "bookstore_app",
    },

    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ production
    logging: process.env.NODE_ENV === "development" ? console.log : false,

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ retry
    retry: {
      max: 3,
      backoffBase: 1000,
      backoffExponent: 1.5,
    },
  }
);
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–§–∞–π–ª `models/index.js` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞  
‚úÖ **–ì–∏–±–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥ (dev/test/prod)  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - —ç–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π

–≠—Ç–æ—Ç —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –≤—Å–µ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –∫–Ω–∏–≥.
