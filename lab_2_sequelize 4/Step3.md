# üèóÔ∏è –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –û–±–∑–æ—Ä

–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –º—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é Sequelize CLI –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö Sequelize –º–æ–¥–µ–ª–µ–π.

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

```bash
npx sequelize-cli db:create
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Database bookstore_dev created.
```

### ‚úÖ 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)

```bash
npx sequelize-cli db:migrate
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
== 20251013143521-create-users: migrated (0.087s)
== 20251013144458-create-books: migrated (0.071s)
```

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

- üìã **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–∫–∞–∑–æ–≤ –≤ JSONB
- üìö **books** - –∫–Ω–∏–≥–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –≤ JSONB

### ‚úÖ 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
npx sequelize-cli db:seed:all
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
== 20251013144632-demo-books: migrated (0.022s)
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ 6 –∫–Ω–∏–≥ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:**

- –†–∞–∑–Ω–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (45-150 –ø–æ–∫—É–ø–æ–∫)
- –†–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ (0-25 —à—Ç—É–∫)
- –†–∞–∑–Ω—ã–µ —Ü–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (550‚ÇΩ-1750‚ÇΩ)

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`

| –ü–æ–ª–µ               | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ                      |
| ------------------ | ------------ | ----------------------------- |
| **id**             | SERIAL       | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID              |
| **email**          | VARCHAR(255) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email –¥–ª—è –≤—Ö–æ–¥–∞    |
| **password_hash**  | VARCHAR(255) | –•–µ—à –ø–∞—Ä–æ–ª—è (bcrypt)           |
| **first_name**     | VARCHAR(100) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è              |
| **last_name**      | VARCHAR(100) | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| **orders_history** | **JSONB**    | üî• **–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –≤ JSON** |
| **created_at**     | TIMESTAMP    | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                 |
| **updated_at**     | TIMESTAMP    | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è               |

### –¢–∞–±–ª–∏—Ü–∞ `books`

| –ü–æ–ª–µ                  | –¢–∏–ø           | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| --------------------- | ------------- | ------------------------------ |
| **id**                | SERIAL        | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID               |
| **title**             | VARCHAR(255)  | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏                 |
| **author**            | VARCHAR(255)  | –ê–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏                    |
| **genre**             | VARCHAR(100)  | –ñ–∞–Ω—Ä –∫–Ω–∏–≥–∏                     |
| **price**             | DECIMAL(10,2) | –¶–µ–Ω–∞ –∫–Ω–∏–≥–∏                     |
| **description**       | TEXT          | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ                |
| **short_description** | TEXT          | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ               |
| **image**             | VARCHAR(255)  | –ò–º—è —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è          |
| **popularity**        | INTEGER       | üî• **–°—á–µ—Ç—á–∏–∫ –ø–æ–∫—É–ø–æ–∫**         |
| **stock**             | INTEGER       | üî• **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ**    |
| **metadata**          | **JSONB**     | üî• **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ** |
| **created_at**        | TIMESTAMP     | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                  |
| **updated_at**        | TIMESTAMP     | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è                |

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ Sequelize –º–æ–¥–µ–ª–∏

### üìÑ `models/User.js` - –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### üîë **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- ‚úÖ **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** (bcrypt, 12 —Ä–∞—É–Ω–¥–æ–≤)
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è email** (—Ñ–æ—Ä–º–∞—Ç –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
- ‚úÖ **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è** (8+ —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ/—Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã)
- ‚úÖ **JSONB –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤** (UUID, –∫–Ω–∏–≥–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, –¥–∞—Ç–∞)
- ‚úÖ **–ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (createUser, authenticate, findByEmail)

#### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
const user = await User.createUser({
  email: "test@example.com",
  password: "SecurePass123",
  first_name: "–ò–≤–∞–Ω",
  last_name: "–ü–µ—Ç—Ä–æ–≤",
});

// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
const authUser = await User.authenticate("test@example.com", "SecurePass123");

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
await user.addOrder({
  book_id: 1,
  title: "–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü",
  quantity: 2,
  price: 450.0,
  total: 900.0,
});

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫
console.log(user.getOrdersCount()); // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
console.log(user.getTotalSpent()); // –û–±—â–∞—è —Å—É–º–º–∞
```

### üìö `models/Book.js` - –ú–æ–¥–µ–ª—å –∫–Ω–∏–≥–∏

#### üîë **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è, —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ)
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏** (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–µ)
- ‚úÖ **JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, ISBN, –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ)
- ‚úÖ **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** (–ø–æ —Ç–µ–∫—Å—Ç—É, –∂–∞–Ω—Ä—É, —Ü–µ–Ω–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
- ‚úÖ **Race condition –∑–∞—â–∏—Ç–∞** (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ FOR UPDATE –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö)

#### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```javascript
// –ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –≤ –Ω–∞–ª–∏—á–∏–∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
const books = await Book.findAvailable({
  limit: 10,
  genre: "–¥–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞",
  priceMin: 300,
  priceMax: 1000,
});

// –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
const results = await Book.search("–ø—Ä–∏–Ω—Ü");

// –ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç race conditions)
const transaction = await sequelize.transaction();
const book = await Book.purchaseBooks(bookId, quantity, transaction);
await transaction.commit();

// –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏
const popular = await Book.findPopular(10);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–∞
const stats = await Book.getStats();
// { total: 6, available: 5, outOfStock: 1, percentage: 83 }
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### üöÄ **–°–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç-—Ñ–∞–π–ª:** `test-models.js`

**–¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

1. ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL**
2. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª—è
3. ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å)
4. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ –Ω–∞–ª–∏—á–∏—é –Ω–∞ —Å–∫–ª–∞–¥–µ
6. ‚úÖ **–ü–æ–∏—Å–∫** –ø–æ —Ç–µ–∫—Å—Ç—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏/–∞–≤—Ç–æ—Ä–µ
7. ‚úÖ **–ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π)
8. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
9. ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–Ω–∏–≥** (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –≤ –Ω–∞–ª–∏—á–∏–∏, –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å)
10. ‚úÖ **–¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö** –∫–Ω–∏–≥

### üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```bash
node test-models.js

üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π Sequelize...

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å–ø–µ—à–Ω–æ!
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: { id: 3, email: 'test@example.com', name: '–ò–≤–∞–Ω –¢–µ—Å—Ç–æ–≤' }
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: –î–∞
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è: –†–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ù–∞–π–¥–µ–Ω–æ 3 –∫–Ω–∏–≥ –≤ –ë–î
‚úÖ –ù–∞–π–¥–µ–Ω–æ 5 –∫–Ω–∏–≥ –≤ –Ω–∞–ª–∏—á–∏–∏ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏)
‚úÖ –ü–æ–∏—Å–∫ –ø–æ "–ø—Ä–∏–Ω—Ü": –Ω–∞–π–¥–µ–Ω–æ 1 –∫–Ω–∏–≥
‚úÖ –ü–æ–∫—É–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–∫–ª–∞–¥ —É–º–µ–Ω—å—à–µ–Ω —Å 8 –¥–æ 7
‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ —Å 120 –¥–æ 121
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 6 –∫–Ω–∏–≥ –≤—Å–µ–≥–æ, 5 –≤ –Ω–∞–ª–∏—á–∏–∏ (83% –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
‚úÖ –¢–æ–ø-3 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥ –ø–æ–ª—É—á–µ–Ω—ã

üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
```

## üîç –î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ

### üìö **–ö–Ω–∏–≥–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ:**

| –ù–∞–∑–≤–∞–Ω–∏–µ             | –ê–≤—Ç–æ—Ä                   | –¶–µ–Ω–∞  | –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å | –°–∫–ª–∞–¥    |
| -------------------- | ----------------------- | ----- | ------------ | -------- |
| **–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü**  | –ê–Ω—Ç—É–∞–Ω –¥–µ –°–µ–Ω—Ç-–≠–∫–∑—é–ø–µ—Ä–∏ | 450‚ÇΩ  | üî• **150**   | 25       |
| **–ì—Ä–æ–∑–∞**            | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –û—Å—Ç—Ä–æ–≤—Å–∫–∏–π    | 550‚ÇΩ  | üî• **121**   | 7        |
| **–ß–µ–ª–æ–≤–µ–∫-–∞–º—Ñ–∏–±–∏—è**  | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë–µ–ª—è–µ–≤        | 1750‚ÇΩ | 95           | 20       |
| **–£–Ω–µ—Å—ë–Ω–Ω—ã–µ –≤–µ—Ç—Ä–æ–º** | –ú–∞—Ä–≥–∞—Ä–µ—Ç –ú–∏—Ç—á–µ–ª–ª        | 900‚ÇΩ  | 86           | 14       |
| **–ú–æ—Ä–µ –∏ –∑–≤–µ–∑–¥—ã**    | –ê–ª–µ–∫—Å–µ–π –ë–∏—Ä—é–ª–∏–Ω         | 1670‚ÇΩ | 45           | 12       |
| **–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏**   | –§—Ä—ç–Ω—Å–∏—Å –§–∏—Ü–¥–∂–µ—Ä–∞–ª—å–¥     | 1200‚ÇΩ | 78           | ‚ùå **0** |

### üéØ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:**

- ‚úÖ –†–∞–∑–Ω—ã–µ **—Ü–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** (low: <500‚ÇΩ, medium: 500-1000‚ÇΩ, high: >1000‚ÇΩ)
- ‚úÖ –†–∞–∑–Ω–∞—è **–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- ‚úÖ **–ù—É–ª–µ–≤–æ–π —Å–∫–ª–∞–¥** —É –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (`romance`, `foreign`, `price-low`)

## üîß –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üìà **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**

**–î–ª—è —Ç–∞–±–ª–∏—Ü—ã users:**

- `users_email_unique_idx` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ email
- `users_created_at_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ

**–î–ª—è —Ç–∞–±–ª–∏—Ü—ã books:**

- `books_popularity_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
- `books_stock_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –Ω–∞–ª–∏—á–∏—é
- `books_genre_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∂–∞–Ω—Ä—É
- `books_author_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∞–≤—Ç–æ—Ä—É
- `books_price_idx` - –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω–µ
- `books_metadata_gin_idx` - **GIN –∏–Ω–¥–µ–∫—Å** –¥–ª—è JSONB –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### üîí **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞:**

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - bcrypt —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - Joi —Å—Ö–µ–º—ã –≤ –º–æ–¥–µ–ª—è—Ö
3. **SQL –∏–Ω—ä–µ–∫—Ü–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Sequelize ORM
4. **Race conditions** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `FOR UPDATE` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
5. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ë–î** - constraints –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL

### ‚ö° **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```javascript
// –ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏ - –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
const transaction = await sequelize.transaction();
try {
  const book = await Book.purchaseBooks(bookId, quantity, transaction);
  await transaction.commit();
} catch (error) {
  await transaction.rollback();
  throw error;
}
```

## üìä SQL –∑–∞–ø—Ä–æ—Å—ã (–ø—Ä–∏–º–µ—Ä—ã)

### üîç **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ –≤ –Ω–∞–ª–∏—á–∏–∏:**

```sql
SELECT * FROM books
WHERE stock > 0
ORDER BY popularity DESC, created_at DESC
LIMIT 10;
```

### üîç **–ü–æ–∏—Å–∫ –ø–æ JSONB –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**

```sql
SELECT * FROM books
WHERE metadata @> '{"categories": ["romance"]}'
AND stock > 0;
```

### üîç **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```sql
SELECT
  email,
  jsonb_array_length(orders_history) as orders_count,
  (
    SELECT SUM((order_item->>'total')::numeric)
    FROM jsonb_array_elements(orders_history) as order_item
  ) as total_spent
FROM users
WHERE id = 1;
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞**
2. ‚úÖ **–ú–æ–¥–µ–ª–∏ Sequelize —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
3. ‚è≥ **–°–æ–∑–¥–∞–Ω–∏–µ Express —Å–µ—Ä–≤–µ—Ä–∞ –∏ API —Ä–æ—É—Ç–æ–≤**
4. ‚è≥ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT –∏ middleware**
5. ‚è≥ **API –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–æ–º**
6. ‚è≥ **API –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –∏ –∫–æ—Ä–∑–∏–Ω—ã**

## üí° –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

- ‚úÖ **2 —Ç–∞–±–ª–∏—Ü—ã –≤–º–µ—Å—Ç–æ 3** - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- ‚úÖ **JSONB –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏** - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —É—á—Ç–µ–Ω—ã

### ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤—Å–µ—Ö —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - JSONB –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ –®–∞–≥—É 4: –°–æ–∑–¥–∞–Ω–∏–µ Express API —Å–µ—Ä–≤–µ—Ä–∞** ‚û°Ô∏è
