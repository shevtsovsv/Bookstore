# üöÄ –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ Express API —Å–µ—Ä–≤–µ—Ä–∞

## üìã –û–±–∑–æ—Ä

–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π REST API —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –∫–Ω–∏–≥ —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ–∏—Å–∫–æ–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø–æ–∫—É–ø–∫–∞–º–∏.

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API

- üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**: `src/routes/`, `src/controllers/`, `src/middleware/`, `src/validators/`
- üîß **–ú–æ–¥—É–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ —Å–ª–æ—è–º
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: JWT, –≤–∞–ª–∏–¥–∞—Ü–∏—è, rate limiting, CORS, Helmet

### ‚úÖ 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- üîê **JWT —Ç–æ–∫–µ–Ω—ã**: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- üìù **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: `POST /api/auth/register` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª—è
- üîì **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: `POST /api/auth/login` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- üë§ **–ü—Ä–æ—Ñ–∏–ª—å**: `GET /api/auth/me` –∏ `PUT /api/auth/profile`
- üìã **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤**: `GET /api/auth/orders` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

### ‚úÖ 3. –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥

- üìö **–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥**: `GET /api/books` —Å –º–æ—â–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- üîç **–ü–æ–∏—Å–∫**: –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É, –∂–∞–Ω—Ä—É, –æ–ø–∏—Å–∞–Ω–∏—é
- üìñ **–î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏**: `GET /api/books/:id` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- üèÜ **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏**: `GET /api/books/popular` –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: `GET /api/books/stats` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### ‚úÖ 4. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫—É–ø–æ–∫

- üõí **–ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏**: `POST /api/books/:id/purchase` —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –∑–∞—â–∏—Ç–æ–π
- üîí **Race condition –∑–∞—â–∏—Ç–∞**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ FOR UPDATE –≤ PostgreSQL
- üìà **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ
- üì¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º**: –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API

### üìÇ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
src/
‚îú‚îÄ‚îÄ controllers/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ authController.js     # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ booksController.js    # –ö–∞—Ç–∞–ª–æ–≥ –∏ –ø–æ–∫—É–ø–∫–∏
‚îú‚îÄ‚îÄ middleware/           # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îî‚îÄ‚îÄ auth.js              # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ routes/              # –ú–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js        # /api/auth/*
‚îÇ   ‚îú‚îÄ‚îÄ booksRoutes.js       # /api/books/*
‚îÇ   ‚îî‚îÄ‚îÄ index.js             # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îî‚îÄ‚îÄ validators/          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    ‚îî‚îÄ‚îÄ index.js             # Joi —Å—Ö–µ–º—ã
```

### üåê **API Endpoints:**

#### üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (`/api/auth/`)

| –ú–µ—Ç–æ–¥  | Endpoint    | –û–ø–∏—Å–∞–Ω–∏–µ                      | –î–æ—Å—Ç—É–ø  |
| ------ | ----------- | ----------------------------- | ------- |
| `POST` | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      | Public  |
| `POST` | `/login`    | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      | Public  |
| `GET`  | `/me`       | –ü—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | Private |
| `PUT`  | `/profile`  | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è            | Private |
| `GET`  | `/orders`   | –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤               | Private |

#### üìö **–ö–Ω–∏–≥–∏** (`/api/books/`)

| –ú–µ—Ç–æ–¥  | Endpoint        | –û–ø–∏—Å–∞–Ω–∏–µ                  | –î–æ—Å—Ç—É–ø  |
| ------ | --------------- | ------------------------- | ------- |
| `GET`  | `/`             | –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π | Public  |
| `GET`  | `/popular`      | –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏          | Public  |
| `GET`  | `/stats`        | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–Ω–∏–≥           | Public  |
| `GET`  | `/:id`          | –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–Ω–∏–≥–∏   | Public  |
| `POST` | `/:id/purchase` | –ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏             | Private |

#### ‚ö° **–£—Ç–∏–ª–∏—Ç—ã** (`/api/`)

| –ú–µ—Ç–æ–¥ | Endpoint  | –û–ø–∏—Å–∞–Ω–∏–µ                   | –î–æ—Å—Ç—É–ø |
| ----- | --------- | -------------------------- | ------ |
| `GET` | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ | Public |
| `GET` | `/info`   | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API          | Public |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

```javascript
// JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
const token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET, {
  expiresIn: "7d",
});

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100, // –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π (–∑–∞–º–µ—á–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è 3)
password: Joi.string()
  .min(8)
  .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
  .required();
```

### üìã **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

```javascript
// Joi —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
const registerSchema = Joi.object({
  email: Joi.string().email().required(),
  password: Joi.string()
    .min(8)
    .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
    .required(),
  first_name: Joi.string().max(100).optional(),
  last_name: Joi.string().max(100).optional(),
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ middleware
app.use("/api/auth/register", validateBody(registerSchema));
```

### üîç **–ú–æ—â–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–Ω–∏–≥**

```javascript
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
GET /api/books?page=1&limit=20&search=–ø—Ä–∏–Ω—Ü&genre=–¥–µ—Ç—Å–∫–∞—è&author=–≠–∫–∑—é–ø–µ—Ä–∏
  &priceMin=300&priceMax=1000&categories=romance,foreign
  &sortBy=popularity&sortOrder=desc&onlyAvailable=true

// JSONB –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
WHERE metadata @> '{"categories": ["romance"]}'

// –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
WHERE title ILIKE '%–ø—Ä–∏–Ω—Ü%' OR author ILIKE '%–ø—Ä–∏–Ω—Ü%'
   OR genre ILIKE '%–ø—Ä–∏–Ω—Ü%' OR description ILIKE '%–ø—Ä–∏–Ω—Ü%'
```

### üîí **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏**

```javascript
// –ó–∞—â–∏—Ç–∞ –æ—Ç Race Conditions (–∑–∞–º–µ—á–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è 7)
const transaction = await sequelize.transaction();
try {
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–∏–≥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  const book = await Book.findByPk(id, {
    lock: transaction.LOCK.UPDATE,
    transaction,
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ
  if (book.stock < quantity) {
    throw new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞");
  }

  // –ê—Ç–æ–º–∞—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∫–ª–∞–¥ –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å
  await book.update(
    {
      stock: book.stock - quantity,
      popularity: book.popularity + quantity,
    },
    { transaction }
  );

  // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  await user.update(
    {
      orders_history: [...orders_history, newOrder],
    },
    { transaction }
  );

  await transaction.commit();
} catch (error) {
  await transaction.rollback();
  throw error;
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ:**

#### üè• **–ó–¥–æ—Ä–æ–≤—å–µ API**

- ‚úÖ Health Check: API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ API Info: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞

#### üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**

- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è

#### üìö **–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥**

- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (5 –∫–Ω–∏–≥ –Ω–∞–π–¥–µ–Ω–æ)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É (–Ω–∞–π–¥–µ–Ω–∞ "–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü")
- ‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ (—Ç–æ–ø-3 –ø–æ–ª—É—á–µ–Ω—ã)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (6 –≤—Å–µ–≥–æ, 5 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö, 83% –≤ –Ω–∞–ª–∏—á–∏–∏)
- ‚úÖ –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–Ω–∏–≥–∏

#### üí∞ **–ü–æ–∫—É–ø–∫–∏**

- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–∫–ª–∞–¥–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–∫—É–ø–æ–∫ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

#### üîç **–í–∞–ª–∏–¥–∞—Ü–∏—è**

- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

```bash
üöÄ === –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø API ===
üìÖ –í—Ä–µ–º—è: 13.10.2025, 18:25:36
üåê –ë–∞–∑–æ–≤—ã–π URL: http://localhost:3000/api

# –í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—ã
# PostgreSQL –∑–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
# JWT —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ

‚úÖ === –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´ –£–°–ü–ï–®–ù–û ===
```

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

### ‚úÖ **–í—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è —É—á—Ç–µ–Ω—ã:**

1. ‚úÖ **Email –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ñ–æ—Ä–º–∞—Ç–∞
2. ‚úÖ **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π** - –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ/—Å—Ç—Ä–æ—á–Ω—ã–µ/—Ü–∏—Ñ—Ä—ã
3. ‚úÖ **–ü–æ–ª–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–∞—Ö
4. ‚úÖ **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ** - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
5. ‚úÖ **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥** - –ø–∞–≥–∏–Ω–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
6. ‚úÖ **Race conditions –∑–∞—â–∏—Ç–∞** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ FOR UPDATE
7. ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –≤–µ—Å—å –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç async/await
8. ‚úÖ **JSON —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - JSONB –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

## üåê –ì–æ—Ç–æ–≤—ã–µ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ API

### üîó **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
POST http://localhost:3000/api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePass123",
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ü–µ—Ç—Ä–æ–≤"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π:

```bash
GET http://localhost:3000/api/books?page=1&limit=20&search=–ø—Ä–∏–Ω—Ü&onlyAvailable=true
```

#### –ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏:

```bash
POST http://localhost:3000/api/books/1/purchase
Authorization: Bearer your_jwt_token_here
Content-Type: application/json

{
  "quantity": 2
}
```

### üì± **–û—Ç–≤–µ—Ç—ã API:**

```json
// –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
{
  "success": true,
  "message": "–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ",
  "data": { /* –¥–∞–Ω–Ω—ã–µ */ }
}

// –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
{
  "success": false,
  "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö",
  "errors": [
    {
      "field": "email",
      "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"
    }
  ]
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫

### ‚öôÔ∏è **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):**

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=bookstore
DB_USER=postgres
DB_PASSWORD=your_password

# JWT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
JWT_SECRET=bookstore_jwt_secret_key_2025_lab2_sequelize_secure
JWT_EXPIRES_IN=7d

# –°–µ—Ä–≤–µ—Ä
PORT=3000
NODE_ENV=development
```

### üöÄ **–ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞:**

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
node test-api.js

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
node test-models.js
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### üéØ **–ß—Ç–æ –≥–æ—Ç–æ–≤–æ:**

- ‚úÖ **15 API endpoints** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
- ‚úÖ **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **PostgreSQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–∞—Ö
- ‚úÖ **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫
- ‚úÖ **CORS –∏ Helmet** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ **Graceful shutdown** –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

### üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- üìà **–ò–Ω–¥–µ–∫—Å—ã PostgreSQL** –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üîÑ **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- üéØ **JSONB** –¥–ª—è –≥–∏–±–∫–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚ö° **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ JWT** –≤ –ø–∞–º—è—Ç–∏
- üõ°Ô∏è **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## üîÆ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–∞–º

**API —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º!**

### üì± **–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø - –®–∞–≥ 5:**

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö HTML —Å—Ç—Ä–∞–Ω–∏—Ü –∫ API
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫—É–ø–æ–∫ —á–µ—Ä–µ–∑ API
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ –∫–Ω–∏–≥–∞–º–∏

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ –®–∞–≥—É 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å API** ‚û°Ô∏è
