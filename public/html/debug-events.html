<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–û—Ç–ª–∞–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π</title>
    <link rel="stylesheet" href="../style/style.css" />
    <style>
      .debug-panel {
        background: #f0f0f0;
        padding: 15px;
        margin: 20px 0;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
      }
      .debug-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        margin: 5px;
        cursor: pointer;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <h1>–û—Ç–ª–∞–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –∫–∞—Ç–∞–ª–æ–≥–∞</h1>

    <div class="debug-panel">
      <h3>–û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
      <button class="debug-button" onclick="checkElements()">
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
      </button>
      <button class="debug-button" onclick="loadAndRender()">
        –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–Ω–∏–≥–∏
      </button>
      <button class="debug-button" onclick="setupEvents()">
        –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
      </button>
    </div>

    <div id="debug-output" class="debug-panel">
      <div>–ì–æ—Ç–æ–≤–æ –∫ –æ—Ç–ª–∞–¥–∫–µ...</div>
    </div>

    <div id="books-container"></div>

    <script>
      let debugOutput = document.getElementById("debug-output");

      function log(message) {
        console.log(message);
        debugOutput.innerHTML +=
          "<div>" + new Date().toLocaleTimeString() + ": " + message + "</div>";
      }

      function checkElements() {
        log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ===");
        log(
          '–ö–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ": ' +
            document.querySelectorAll(".btn-details").length
        );
        log(
          '–ö–Ω–æ–ø–∫–∏ "–ó–∞–∫–∞–∑–∞—Ç—å": ' + document.querySelectorAll(".btn-order").length
        );
        log("–ö–∞—Ä—Ç–æ—á–∫–∏ –∫–Ω–∏–≥: " + document.querySelectorAll(".book-card").length);
        log(
          "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–∏–≥: " +
            (document.getElementById("books-container")
              ? "–Ω–∞–π–¥–µ–Ω"
              : "–Ω–µ –Ω–∞–π–¥–µ–Ω")
        );
      }

      async function loadAndRender() {
        log("=== –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ ===");
        try {
          const response = await fetch("../data/books.json");
          const data = await response.json();
          log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–Ω–∏–≥: " + data.books.length);

          const container = document.getElementById("books-container");
          let html = "";

          data.books.slice(0, 2).forEach((book) => {
            html += `
                        <div id="${book.id}" class="book-card" data-book-id="${book.id}">
                            <div class="book-info">
                                <h3>${book.title}</h3>
                                <p>–ê–≤—Ç–æ—Ä: ${book.author}</p>
                                <p>–¶–µ–Ω–∞: ${book.price} —Ä—É–±.</p>
                                <div class="book-actions">
                                    <button class="btn btn-order" data-book-id="${book.id}">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                                    <button class="btn btn-details" data-book-id="${book.id}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                                </div>
                            </div>
                        </div>
                    `;
          });

          container.innerHTML = html;
          log("HTML –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä");
          checkElements();
        } catch (error) {
          log("–û—à–∏–±–∫–∞: " + error.message);
        }
      }

      function setupEvents() {
        log("=== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π ===");

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
        document.querySelectorAll(".btn-details").forEach((button, index) => {
          log(`–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" #${index}`);
          button.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            const bookId = this.getAttribute("data-book-id");
            log("üîç –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º –∫–Ω–∏–≥–∏: " + bookId);
            // window.location.href = `book-detail.html?id=${bookId}`;
            alert("–ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–Ω–∏–≥–µ: " + bookId);
          });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ó–∞–∫–∞–∑–∞—Ç—å"
        document.querySelectorAll(".btn-order").forEach((button, index) => {
          log(`–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–∫–∞–∑–∞—Ç—å" #${index}`);
          button.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            const bookId = this.getAttribute("data-book-id");
            log("üõí –ó–∞–∫–∞–∑ –∫–Ω–∏–≥–∏: " + bookId);
            alert("–ó–∞–∫–∞–∑ –∫–Ω–∏–≥–∏: " + bookId);
          });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º
        document.querySelectorAll(".book-card").forEach((card, index) => {
          log(`–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É #${index}`);
          card.addEventListener("click", function (e) {
            log("–ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ, target: " + e.target.tagName);
            if (!e.target.closest(".book-actions")) {
              const bookId = this.getAttribute("data-book-id");
              log("üìö –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–Ω–∏–≥–∏: " + bookId);
              alert("–ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ: " + bookId);
            } else {
              log("–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º");
            }
          });
          card.style.cursor = "pointer";
        });

        log("–°–æ–±—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã");
      }
    </script>
  </body>
</html>
